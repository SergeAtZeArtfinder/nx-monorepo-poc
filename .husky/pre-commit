#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo '\n ==========================================================================\n\n  ğŸ—ï¸ğŸ‘· Pre-commit checks: Styling, testing and building your project.\n\n ==========================================================================\n'


echo '\n =====================================\n âœï¸ğŸ‘©â€ğŸ”¬ Formatting checks...\n =====================================\n'
nx affected -t format:check ||
(
    echo 'ğŸ¤¢ğŸ¤®ğŸ¤¢ğŸ¤® Your formatting fails. ğŸ¤¢ğŸ¤®ğŸ¤¢ğŸ¤®
           Run `nx affected -t format:write` to format your code and try commit again.';
    false;
)


echo '\n =====================================\nğŸ‘©â€ğŸ”¬ğŸ‘€ ESLint checks...\n =====================================\n'
nx affected -t lint ||
(
    echo 'ğŸ¤¢ğŸ¤®ğŸ¤¢ğŸ¤® Your ESLint code styling fails. ğŸ¤¢ğŸ¤®ğŸ¤¢ğŸ¤®
           Run `nx affected -t lint` to check your code style, apply fixes and try commit again.';
    false;
)

echo '\n =====================================\nğŸ› ï¸âš™ï¸ TypeScript types check...\n =====================================\n'
nx affected -t typecheck ||
(
    echo 'ğŸ¤¡ğŸ˜‚âŒğŸ¤¡ Failed TS Type check. ğŸ¤¡ğŸ˜‚âŒğŸ¤¡
            Are you seriously trying to write that? Run `nx affected -t typecheck `, make the changes required and try commit again.'
    false;
)


echo '\n =====================================\n ğŸƒâ€â™€ï¸ğŸƒâ€â™‚ï¸ğŸƒğŸ½ Running unit tests...\n =====================================\n'
nx affected -t test ||
(
    echo 'ğŸ¤¡ğŸ˜‚âŒğŸ’¥ Kaboom!!! Failed Unit tests. ğŸ’¥ğŸ¤¡âŒğŸ¤¡
            Seriously ğŸ˜œ? Run `nx affected -t test`. Apply fixes and try commit again.'
    false;
)


echo '\n =====================================\n ğŸŒğŸŒğŸŒ Running End-to-end tests...\n =====================================\n'
nx affected --parallel 1 -t e2e-ci  ||
(
    echo 'ğŸ¤¡ğŸ˜‚ğŸ˜œğŸ˜œ Ha! Failed E2E tests. ğŸ¤¡ğŸ˜‚ğŸ˜œğŸ˜œ
            Well ğŸ˜œ, check your ui changes - maybe not your fault. Run again `nx affected -t e2e --ui` with UI option. Apply fixes if needed and try commit again.'
    false;
)


echo '\n =====================================\n ğŸ—ï¸ğŸ‘·ğŸ› ï¸ Making production build...\n =====================================\n'
nx run fe:build ||
(
    echo 'âŒğŸ‘·ğŸ”¨âŒ Better call Bob Marley... Because the app build has failed âŒğŸ‘·ğŸ”¨âŒ
            Try to re-build `nx run fe:build`, then check for errors to see why. 
    '
    false;
)

echo '\n ===================================================================================\n\nâœ…âœ…âœ…âœ… You are Great! ğŸ‘ All checks passed... I am committing this now. âœ…âœ…âœ…âœ… \n\n ===================================================================================\n'